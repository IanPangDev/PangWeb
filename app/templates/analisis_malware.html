{% extends "post.html" %}

{% block title %}Tráfico malicioso{% endblock %}

{% block post %}
    <!-- Post -->
    <article class="wrapper style1">
        <div class="container">
            <header>
                <h1 style="text-align: center;"><strong>Tráfico malicioso</strong></h1>
            </header>
            <p style="text-align: justify;">Analicé un 
                <a href="https://www.kaggle.com/datasets/agungpambudi/network-malware-detection-connection-analysis" target="_blank">dataset</a>
                con un millón de registros en el que se aplicaba la etiqueta PartOfAHorizontalPortScan. Esta etiqueta se utiliza cuando las conexiones forman parte de un escaneo horizontal de puertos con el objetivo de recopilar información para posibles ataques futuros. La decisión de etiquetado se basa en patrones como puertos compartidos, cantidades similares de bytes transmitidos y múltiples direcciones IP de destino distintas entre las conexiones.
                <br>El objetivo es crear un sistema capaz de detectar el tráfico malicioso dentro de la red.
            </p>
            
            <h2 style="text-align: center;">Tecnologías</h2>
            
            <ul>
                <li style="text-align: left;">Python</li>
                    <ul style="margin-bottom: 0%;">
                        <li style="text-align: left; font-size: medium;">Pandas</li>
                        <li style="text-align: left; font-size: medium;">Sklearn</li>
                    </ul>
                <li style="text-align: left;">Tableau</li>
            </ul>

            <h2 style="text-align: center;">Análisis</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                    <tr style="text-align: center; ">
                        <th></th>
                        <th>ts</th>
                        <th>uid</th>
                        <th>id.orig_h</th>
                        <th>id.orig_p</th>
                        <th>id.resp_h</th>
                        <th>id.resp_p</th>
                        <th>proto</th>
                        <th>service</th>
                        <th>duration</th>
                        <th>orig_bytes</th>
                        <th>...</th>
                        <th>local_resp</th>
                        <th>missed_bytes</th>
                        <th>history</th>
                        <th>orig_pkts</th>
                        <th>orig_ip_bytes</th>
                        <th>resp_pkts</th>
                        <th>resp_ip_bytes</th>
                        <th>tunnel_parents</th>
                        <th>label</th>
                        <th>detailed-label</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th>0</th>
                        <td>1525879831.015811</td>
                        <td>CUmrqr4svHuSXJy5z7</td>
                        <td>192.168.100.103</td>
                        <td>51524</td>
                        <td>65.127.233.163</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>-</td>
                        <td>2.999051</td>
                        <td>0</td>
                        <td>...</td>
                        <td>-</td>
                        <td>0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td>Malicious</td>
                        <td>PartOfAHorizontalPortScan</td>
                    </tr>
                    <tr>
                        <th>1</th>
                        <td>1525879831.025055</td>
                        <td>CH98aB3s1kJeq6SFOc</td>
                        <td>192.168.100.103</td>
                        <td>56305</td>
                        <td>63.150.16.171</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>...</td>
                        <td>-</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td>Malicious</td>
                        <td>PartOfAHorizontalPortScan</td>
                    </tr>
                    <tr>
                        <th>2</th>
                        <td>1525879831.045045</td>
                        <td>C3GBTkINvXNjVGtN5</td>
                        <td>192.168.100.103</td>
                        <td>41101</td>
                        <td>111.40.23.49</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>...</td>
                        <td>-</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td>Malicious</td>
                        <td>PartOfAHorizontalPortScan</td>
                    </tr>
                    <tr>
                        <th>3</th>
                        <td>1525879832.016240</td>
                        <td>CDe43c1PtgynajGI6</td>
                        <td>192.168.100.103</td>
                        <td>60905</td>
                        <td>131.174.215.147</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>-</td>
                        <td>2.998796</td>
                        <td>0</td>
                        <td>...</td>
                        <td>-</td>
                        <td>0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td>Malicious</td>
                        <td>PartOfAHorizontalPortScan</td>
                    </tr>
                    <tr>
                        <th>4</th>
                        <td>1525879832.024985</td>
                        <td>CJaDcG3MZzvf1YVYI4</td>
                        <td>192.168.100.103</td>
                        <td>44301</td>
                        <td>91.42.47.63</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>...</td>
                        <td>-</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td>Malicious</td>
                        <td>PartOfAHorizontalPortScan</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <figcaption style="text-align: center; margin-bottom: 3%"><i><u>Muestra del dataset</u></i></figcaption>
            
            <p style="text-align: justify;">Grafiqué la cantidad de casos para poder saber si esta balanceada.</p>
            <a><img src="{{ url_for('static', filename='images/analisis_malware_muestras.png') }}" alt="" style="width: 60%;"/></a>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Grafica de barras que muestra la cantidad de muestras por tipo de trafico</u></i></figcaption>
            
            <p style="text-align: justify;">Algunas columnas tienen bastantes datos vacíos, por lo que elimine las columnas que tenían menos del 40% y otras innecesarias.</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr style="text-align: right;">
                        <th></th>
                        <th>ts</th>
                        <th>id.orig_p</th>
                        <th>id.resp_h</th>
                        <th>id.resp_p</th>
                        <th>proto</th>
                        <th>conn_state</th>
                        <th>missed_bytes</th>
                        <th>history</th>
                        <th>orig_pkts</th>
                        <th>orig_ip_bytes</th>
                        <th>resp_pkts</th>
                        <th>resp_ip_bytes</th>
                        <th>label</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th>0</th>
                        <td>1525879831.015811</td>
                        <td>51524</td>
                        <td>65.127.233.163</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        </tr>
                        <tr>
                        <th>1</th>
                        <td>1525879831.025055</td>
                        <td>56305</td>
                        <td>63.150.16.171</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        </tr>
                        <tr>
                        <th>2</th>
                        <td>1525879831.045045</td>
                        <td>41101</td>
                        <td>111.40.23.49</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        </tr>
                        <tr>
                        <th>3</th>
                        <td>1525879832.016240</td>
                        <td>60905</td>
                        <td>131.174.215.147</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        </tr>
                        <tr>
                        <th>4</th>
                        <td>1525879832.024985</td>
                        <td>44301</td>
                        <td>91.42.47.63</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Muestra del dataset reducido</u></i></figcaption>
            
            <p style="text-align: justify;">Como se tiene el puerto que se solicita al servidor, decidí añadir una 
                <a href="https://github.com/maraisr/ports-list/blob/main/tcp.csv" target="_blank">base de datos</a>
                que contenga el servicio asociado a dicho puerto.</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                        <th></th>
                        <th style="text-align: center;">protocol</th>
                        <th style="text-align: center;">port</th>
                        <th style="text-align: center;">description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th>0</th>
                        <td>TCP</td>
                        <td>0</td>
                        <td>Reserved</td>
                        </tr>
                        <tr>
                        <th>1</th>
                        <td>TCP</td>
                        <td>1</td>
                        <td>Port Service Multiplexer</td>
                        </tr>
                        <tr>
                        <th>2</th>
                        <td>TCP</td>
                        <td>2</td>
                        <td>Management Utility</td>
                        </tr>
                        <tr>
                        <th>3</th>
                        <td>TCP</td>
                        <td>3</td>
                        <td>Compression Process</td>
                        </tr>
                        <tr>
                        <th>4</th>
                        <td>TCP</td>
                        <td>4</td>
                        <td>Unassigned</td>
                        </tr>
                    </tbody>
                    </table>
            </div>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Muestra de BD puertos y servicos</u></i></figcaption>

            <p style="text-align: justify;">Además, al observar que se tenía la ip del cliente, procedí a obtener la ubicación de este para ampliar la información.</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr style="text-align: right;">
                        <th></th>
                        <th>ts</th>
                        <th>id.orig_p</th>
                        <th>id.resp_p</th>
                        <th>proto</th>
                        <th>conn_state</th>
                        <th>history</th>
                        <th>orig_pkts</th>
                        <th>orig_ip_bytes</th>
                        <th>resp_pkts</th>
                        <th>resp_ip_bytes</th>
                        <th>label</th>
                        <th>country_name</th>
                        <th>description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th>0</th>
                        <td>1.525880e+09</td>
                        <td>51524</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        <td>United States of America</td>
                        <td>Telnet</td>
                        </tr>
                        <tr>
                        <th>1</th>
                        <td>1.525880e+09</td>
                        <td>56305</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        <td>United States of America</td>
                        <td>Telnet</td>
                        </tr>
                        <tr>
                        <th>2</th>
                        <td>1.525880e+09</td>
                        <td>41101</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        <td>China</td>
                        <td>Telnet</td>
                        </tr>
                        <tr>
                        <th>3</th>
                        <td>1.525880e+09</td>
                        <td>60905</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>S</td>
                        <td>3</td>
                        <td>180</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        <td>Netherlands (Kingdom of the)</td>
                        <td>Telnet</td>
                        </tr>
                        <tr>
                        <th>4</th>
                        <td>1.525880e+09</td>
                        <td>44301</td>
                        <td>23</td>
                        <td>tcp</td>
                        <td>S0</td>
                        <td>S</td>
                        <td>1</td>
                        <td>60</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Malicious</td>
                        <td>Germany</td>
                        <td>Telnet</td>
                        </tr>
                    </tbody>
                    </table>
            </div>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Muestra de dataset mejorado</u></i></figcaption>

            <p style="text-align: justify;">Toda el dataset lo exporte a Tableau para hacer el siguiente Dashboard.</p>
            <div class='container' id='viz17' style="display: flex; justify-content: center;">
                <noscript>
                    <a href='#'>
                        <img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;Analisisdetraficomalicioso&#47;Dashboard1&#47;1_rss.png' style='border: none;' />
                    </a>
                </noscript>
                <object class='tableauViz'  style='display:none;'>
                    <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
                    <param name='embed_code_version' value='3' /> 
                    <param name='site_root' value='' />
                    <param name='name' value='Analisisdetraficomalicioso&#47;Dashboard1' />
                    <param name='tabs' value='no' />
                    <param name='toolbar' value='yes' />
                    <param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;An&#47;Analisisdetraficomalicioso&#47;Dashboard1&#47;1.png' /> 
                    <param name='animate_transition' value='yes' />
                    <param name='display_static_image' value='yes' />
                    <param name='display_spinner' value='yes' />
                    <param name='display_overlay' value='yes' />
                    <param name='display_count' value='yes' />
                    <param name='language' value='es-ES' />
                </object>
            </div>                
            <script type='text/javascript'>                    
            var divElement = document.getElementById('viz17');                    
            var vizElement = divElement.getElementsByTagName('object')[0];                    
            if ( divElement.offsetWidth > 800 ) { vizElement.style.width='100%';vizElement.style.height='827px';} 
            else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='500px';vizElement.style.height='1000px';} 
            else { vizElement.style.width='100%';vizElement.style.height='977px';}                     
            var scriptElement = document.createElement('script');                    
            scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    
            vizElement.parentNode.insertBefore(scriptElement, vizElement);                
            </script>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Dashboard del dataset</u></i></figcaption>

            <p style="text-align: justify;">Plantee usar un modelo de Machine Learning para poder predecir cuándo se efectué este escaneo.
                <br>Con ello en mente, realice una transformación de tipo label encoding a los datos categóricos. 
                Además, normalice los datos porque con esto algunos algoritmos funcionan mejor. 
            </p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr style="text-align: right;">
                        <th></th>
                        <th>ts</th>
                        <th>id.orig_p</th>
                        <th>id.resp_p</th>
                        <th>proto</th>
                        <th>conn_state</th>
                        <th>history</th>
                        <th>orig_pkts</th>
                        <th>orig_ip_bytes</th>
                        <th>resp_pkts</th>
                        <th>resp_ip_bytes</th>
                        <th>label</th>
                        <th>country_name</th>
                        <th>description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th>0</th>
                        <td>1.831704e-09</td>
                        <td>0.786544</td>
                        <td>0.000351</td>
                        <td>0.5</td>
                        <td>0.6</td>
                        <td>0.176</td>
                        <td>0.050000</td>
                        <td>0.060201</td>
                        <td>0.0</td>
                        <td>0.0</td>
                        <td>1</td>
                        <td>0.952174</td>
                        <td>0.666880</td>
                        </tr>
                        <tr>
                        <th>1</th>
                        <td>2.477801e-08</td>
                        <td>0.859533</td>
                        <td>0.000351</td>
                        <td>0.5</td>
                        <td>0.6</td>
                        <td>0.176</td>
                        <td>0.016667</td>
                        <td>0.020067</td>
                        <td>0.0</td>
                        <td>0.0</td>
                        <td>1</td>
                        <td>0.952174</td>
                        <td>0.666880</td>
                        </tr>
                        <tr>
                        <th>2</th>
                        <td>7.439913e-08</td>
                        <td>0.627422</td>
                        <td>0.000351</td>
                        <td>0.5</td>
                        <td>0.6</td>
                        <td>0.176</td>
                        <td>0.016667</td>
                        <td>0.020067</td>
                        <td>0.0</td>
                        <td>0.0</td>
                        <td>1</td>
                        <td>0.182609</td>
                        <td>0.666880</td>
                        </tr>
                        <tr>
                        <th>3</th>
                        <td>2.485197e-06</td>
                        <td>0.929759</td>
                        <td>0.000351</td>
                        <td>0.5</td>
                        <td>0.6</td>
                        <td>0.176</td>
                        <td>0.050000</td>
                        <td>0.060201</td>
                        <td>0.0</td>
                        <td>0.0</td>
                        <td>1</td>
                        <td>0.634783</td>
                        <td>0.666880</td>
                        </tr>
                        <tr>
                        <th>4</th>
                        <td>2.506906e-06</td>
                        <td>0.676274</td>
                        <td>0.000351</td>
                        <td>0.5</td>
                        <td>0.6</td>
                        <td>0.176</td>
                        <td>0.016667</td>
                        <td>0.020067</td>
                        <td>0.0</td>
                        <td>0.0</td>
                        <td>1</td>
                        <td>0.330435</td>
                        <td>0.666880</td>
                        </tr>
                    </tbody>
                    </table>
            </div>
            <figcaption style="text-align: center; margin-bottom: 3%;"><i><u>Muestra del dataset codificado y normalizado</u></i></figcaption>
            
            <p style="text-align: justify;">Compare la exactitud de los siguientes modelos: CatBoostClassifier, XGBClassifier, KNeighborsClassifier, DecisionTreeClassifier, RandomForestClassifier.
                <br><strong>Es importante resaltar que estamos en un caso de clasificación, ya que se decidirá si es tráfico malicioso o no.</strong>
            </p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                        <th style="text-align: left;">Ranking</th>
                        <th style="text-align: center;">Modelo</th>
                        <th style="text-align: center;">Accuracy</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <th>1</th>
                        <td>CatBoostClassifier</td>
                        <td>0.999953</td>
                        </tr>
                        <tr>
                        <th>2</th>
                        <td>XGBClassifier</td>
                        <td>0.999722</td>
                        </tr>
                        <tr>
                        <th>3</th>
                        <td>KNeighborsClassifier</td>
                        <td>0.99215</td>
                        </tr>
                        <tr>
                        <th>4</th>
                        <td>DecisionTreeClassifier</td>
                        <td>0.903404</td>
                        </tr>
                        <tr>
                        <th>5</th>
                        <td>RandomForestClassifier</td>
                        <td>0.895431</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p style="text-align: justify;">Como se puede observar en la tabla, el modelo que más nos podría beneficiar seria el <strong>CatBoostClassifier</strong>.</p>

        </div>
    </article>
{% endblock %}